#!/usr/bin/env sh

set -e

test -n "$1" || (echo "Missing argument: Release version" && false)

git tag "v$1"
VERSION="$(python setup.py --version)"

rm -rf parsemon2.egg-info

python setup.py sdist
python setup.py bdist_wheel

for file in dist/parsemon2-${VERSION}.tar.gz $(ls dist/parsemon2-${VERSION}-*.whl); do
    twine upload $file
done

git push --tags
